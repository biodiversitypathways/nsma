---
title: "Report on the use of passive acoustic monitoring for the North Slave Métis Alliance"
format:
  html:
    grid:
      margin-width: 300px
navbar: right
theme: cosmo
date: "`r format(Sys.time(), '%d %B, %Y')`"
author: 
  - name: "Alex MacPhail"
    affiliation: "Biodiversity Pathways Ltd."
  - name: "Orna Phelan"
    affiliation: "North Slave Métis Alliance"
editor: visual
bibliography: references.bib
nocite: '@*'
toc: true
toc-depth: 3
toc-expand: true
toc-location: left
styles: styles.css
github: https://github.com/biodiversitypathways/nsma
---

![Forest near Behchoko, NWT. Credit Michelle Knaggs.](./assets/slavelake.png)

```{r}
#| label: load-packages and authenticate
#| include: false
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(tidyverse)
library(leaflet)
library(wildrtrax)
library(sf)
library(ggridges)
library(kableExtra)
library(plotly)
library(DT)
library(vegan)

wt_auth(force = T)

load('nsma.RData')
#save.image('nsma.RData')
```

# Abstract

The North Slave Métis Alliance deployed Autonomous Recording Units (ARUs) across `r nrow(locs_summary)` locations over three years to characterize the acoustic community. This project is part of a larger community based monitoring program of the NSMA Guardianship Program that involves using game cameras, ARUs, water quality sampling and eDNA to assess biodiversity in the North Slave Region. A total of `r nrow(distinct_spp)` species were detected by ARUs, with species accumulation stabilizing as deployment coverage expanded. These results highlight the effectiveness of ARUs in detecting species and their potential to enhance species monitoring programs comprehensively. Continued long-term sampling and the inclusion of new locations reflecting the dynamic northern landscape are recommended to sustain and improve monitoring efforts.

::: {.callout-note collapse="true" style="background-color: #f4f4f4; padding: 20px;"}
This report is dynamically generated, meaning its results may evolve with the addition of new data or further analyses. For the most recent updates, refer to the publication date and feel free to reach out to the authors.
:::

```{r Data download}
#| warning: false
#| message: false
#| echo: true
#| eval: false
#| include: true
#| code-fold: true

nsma_projects <- wildrtrax::wt_get_download_summary(sensor = 'ARU') |>
  filter(grepl('^North Slave', project)) |>
  select(project_id) |>
  pull()

nsma_main <-
  map_dfr(
    .x = nsma_projects,
    .f = ~ wildrtrax::wt_download_report(
      project_id = .x,
      sensor_id = "ARU",
      weather_cols = T,
      reports = "main"
    )
  )
```

# Land Acknowledgement

We acknowledge the traditional lands and territories of the North Slave Métis Alliance (NSMA), whose members trace their origins to the early unions of French fur-traders and Indigenous women of the Great Slave Lake region. The Métis of this area have long existed as a distinct and vibrant community, exercising their harvesting rights across the Northwest Territories and beyond. We honour their continued stewardship of these lands and their rights recognized under section 35(1) of the Constitution Act, 1982.

# Introduction

Human activities have been identified as key pressures and contributors to the global decline in forest wildlife (@allan2017recent). The repercussions of habitat fragmentation (@fahrig2003effects) and loss (@hanski2011habitat), climate change (@mantyka2012interactions, @sattar2021review, @abrahms2023climate), and increased access to sensitive areas exert direct and indirect pressures on forest biodiversity, particularly in managed regions in Canada (@lemieux2011state). Climate change and increasing wildfire activity in the western and northern boreal have significantly impacted biodiversity and species interactions in this area. Wildfire severity, intensified by climate change, significantly influences avian communities in northern boreal regions, with increasing severity favouring generalist and fire-specialist species while reducing species richness and functional diversity in sensitive habitats such as peatlands (@knaggs2020avian). Furthermore, efforts to use umbrella species, like woodland caribou, for boreal landbird conservation highlights the need for complementary conservation measures (@micheletti2023will) that work in tandem.

In 2023, the North Slave Métis Alliance initiated a program incorporating autonomous recording units (ARUs) for passive acoustic monitoring of the vocalizing wildlife. ARUs are compact environmental sensors that are designed to passively record the environment (@aru-overview), capturing vocalizing species like birds and amphibians, which is growing in use across the globe (@lots-of-pam). This technology enables resource managers to conduct prolonged surveys with minimal human interference. The subsequent data collected by these units contribute valuable information to metrics that can be used to study species trends over time, whereby this data aids decision-making and management within the region. Given the rapid and ease of accumulating data from these units, maintaining a high standard of data integrity is paramount to ensure future data interoperability and sharing. [WildTrax](https://www.wildtrax.ca) is an online platform developed by the [Alberta Biodiversity Monitoring Institute (**ABMI**)](https://abmi.ca) for users of environmental sensors to help addresses these big data challenges by providing solutions to standardize, harmonize, and share data.

The report summarizes the data collected from the ARUs by the NSMA from 2022 to 2024. To enhance accessibility and reproducibility, the findings will be presented in this online report with fully documented code, allowing future updates as data collection methods become standardized. Additionally, recommendations will be developed to refine data transcription priorities, improve annual reporting methods, and evaluate recommendations for long-term monitoring. The objectives of this report are to:

-   Document and standardize the data management and processing procedures for acoustic data collected to ensure consistency and reproducibility.
-   Provide a comprehensive report detailing all detected species and the abundance of individuals within the surveyed area.
-   Facilitate the publication of data, making it accessible to the community, public, resource managers, academic institutions, and other relevant agencies to promote transparency and collaboration.
-   Use evaluation results to establish robust metrics that can inform long-term monitoring and conservation strategies.

# Methods

Survey site selection was guided by the goal of capturing a representative sample of the region's diverse habitats while considering logistical feasibility. In addition, NSMA member’s Traditional Knowledge of the land and historical distribution of species at risk was incorporated into the study design. Several NSMA members were interviewed and asked to identify areas of interest for sampling based on the following criteria: 1) current or historical presence of the target species at risk in the North Slave region; 2) locations of importance to traditional harvesting of NSMA membership and 3)  locations where multiple species, SAR or non-SAR, are present. The Taiga Shield Ecozone encompasses a heterogeneous landscape of upland forests, wetlands, peatlands, and freshwater systems. Sampling locations were strategically distributed to maximize coverage across these habitat types while also sampling areas of importance to NSMA members, enabling a comprehensive assessment of species diversity and abundance. Detailed coordinates and descriptions of the sampling locations are provided in @tbl-loc-summary. ARUs were deployed over three consecutive years (2022, 2023, and 2024); in 2022, two locations were surveyed at Old Fort Rae (62.65084, -115.8187; 62.64749, -115.8198). The survey expanded in 2023 to include eight locations spanning a larger geographic area, from Whatì (63.10753, -116.9763) to Tibbitt Lake (62.5474, -113.3551). In 2024, four additional sites were added to the original eight, increasing the total to twelve locations and enhancing spatial coverage. ARUs were deployed at each site to continuously record the soundscape, allowing for the analysis of acoustic activity patterns and species presence across the study area.

```{r}
#| warning: false
#| echo: true
#| eval: true
#| message: false
#| include: true
#| collapse: true
#| code-fold: true
#| fig-align: center
#| fig-cap: Locations from North Slave Métis Alliance ARU Monitoring Program
#| label: fig-aru-monitoring-locations

nsma_locs <- nsma_main |>
  mutate(year = lubridate::year(recording_date_time)) |>
  select(location, latitude, longitude, year) |>
  distinct() |>
  drop_na(latitude) |>
  sf::st_as_sf(coords = c("longitude","latitude"), crs = 4326)

locs_summary <- nsma_locs |>
  st_drop_geometry() |>
  group_by(location, year) |>
  mutate(value = row_number()) |>
  ungroup() |>
  arrange(year) |>
  pivot_wider(names_from = year, values_from = value, values_fill = 0) |>
  rename('Location' = location)

nsma_locs_2022 <- nsma_locs |> filter(year == 2022)
nsma_locs_2023 <- nsma_locs |> filter(year == 2023)
nsma_locs_2024 <- nsma_locs |> filter(year == 2024)

# Create leaflet map with layer groups
leaflet() %>%
  addTiles() %>%
  addCircleMarkers(data = nsma_locs_2022, 
                   color = "yellow", 
                   group = "2022 Locations",
                   popup = ~paste("Location:", location)) %>%
  addCircleMarkers(data = nsma_locs_2023, 
                   color = "blue", 
                   group = "2023 Locations",
                   popup = ~paste("Location:", location)) %>%
  addCircleMarkers(data = nsma_locs_2024, 
                   color = "red", 
                   group = "2024 Locations",
                   popup = ~paste("Location:", location)) %>%
  addLayersControl(
    overlayGroups = c("2022 Locations", "2023 Locations", "2024 Locations"),
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  addMeasure() %>%
  addMiniMap(position = "bottomleft")

```

```{r}
#| warning: false
#| echo: true
#| eval: true
#| message: false
#| include: true
#| label: tbl-loc-summary
#| collapse: true
#| code-fold: true
#| tbl-cap: Locations surveyed across years. Ones indicated a deployment in that year for that location.

datatable(locs_summary, 
          options = list(
            searching = TRUE,  
            paging = TRUE,    
            pageLength = 10   
          )) |>
  formatStyle(columns = colnames(locs_summary), 
              backgroundColor = styleEqual(c("NA"), "lightgray"))  
```

Media were transferred via hard drive to the University of Alberta in Edmonton, where they are redundantly stored on a server known as Cirrus. The recordings were standardized to ensure adherence to the naming convention of `LOCATION_DATETIME`, such as `PREDULE-LAKE-1_20230625_053500.wav`. Recordings were also directly uploaded to WildTrax for processing and can be downloaded from the platform's Recording tab, accessible under Manage \> Download list of recordings (see @fig-download-recs).

![Downloading a list of recordings from WildTrax](assets/download-recs.png){#fig-download-recs}

The principal goal for data processing was to describe the acoustic community of species heard at locations while choosing a large enough subset of recordings for analyses. To ensure balanced replication, for each location and year surveyed, four randomly selected recordings were processed for 3-minutes between the hours of 3:00 AM - 7:59 AM ideally on four separate dates. Four recordings ensures that there is minimum number of samples for a simple occupancy analysis (@mackenzie2002estimating and @imperfect-occu). Tags are made using count-removal (see @farnsworth2002removal, @time-removal) where tags are only made at the time of first detection of each individual heard on the recordings. We also verified that all tags that were created were checked by a second observer (n = `r verified_tags |> select(Proportion) |> slice(3) |> pull()`) to ensure accuracy of detections (see @tbl-verified). Amphibian abundance was estimated at the time of first detection using the [North American Amphibian Monitoring Program](https://www.usgs.gov/centers/eesc/science/north-american-amphibian-monitoring-program) with abundance of species being estimated on the scale of "calling intensity index" (CI) of 1 - 3. Mammals such as Red Squirrel, were also noted on the recordings. After the data are processed in WildTrax, the [wildrtrax](https://abbiodiversity.github.io/wildrtrax/) package is used to download the data into a standard format prepared for analysis. The `wt_download_report` function downloads the data directly to a R framework for easy manipulation (see [wildrtrax APIs](https://abbiodiversity.github.io/wildrtrax/articles/apis.html)).

![WildTrax Acoustic Processing Interface (Version 1)](assets/acousticprocessing.png){#fig-acousticprocessing .float-left .fig-align-center}

```{r}
#| warning: false
#| echo: false
#| message: false
#| eval: true
#| include: true
#| label: tbl-verified
#| tbl-cap: Proportion of tags verified
#| code-fold: true

all_tags <- nsma_main |> 
  tally() |>
  pull()

verified_tags <- nsma_main |>
  group_by(tag_is_verified) |>
  tally() |>
  mutate(Proportion = round(n / all_tags,4)*100) |>
  rename("Count" = n) |>
  rename("Tag is verified" = tag_is_verified)

kable(verified_tags)
```

# Analysis

To evaluate species richness and activity patterns, we grouped the data by year and location using the `dplyr` package identifying unique species detected in tasks processed within WildTrax. This enabled the creation of species richness and activity plots for the results using `ggplot`. We used the `vegan` package in R to construct a species accumulation curve, assessing the sampling effort required to capture species richness. The analysis utilized a species-by-site matrix and employed a randomized accumulation method with 100 permutations to provide robust estimates of species richness as sampling sites increased.

# Results

```{r}
#| warning: false
#| message: false
#| echo: false
#| eval: true
#| include: true
#| code-fold: true
#| fig-align: center
#| fig-cap: All recordings collected from the ARU monitoring program
#| label: fig-all-recs

all_recs <- wt_get_recordings('NSMA') |>
  as_tibble() |>
  unnest(everything()) |>
  mutate(year = year(ymd_hms(recording_date_time)),
         julian = yday(recording_date_time))

ggplot(all_recs, aes(x = julian, y = location)) + 
  geom_density_ridges(scale = 3, rel_min_height = 0.005, alpha = 0.4) + 
  scale_y_discrete(limits = rev(levels(all_recs$location))) + 
  scale_fill_viridis_d() +
  theme_bw() +
  facet_wrap(~year) +
  xlab("Day of Year") + 
  ylab("Species")

```

```{r}
#| warning: false
#| message: false
#| echo: false
#| eval: true
#| include: false
#| code-fold: true

spp_rich_location <- nsma_main |>
  as_tibble() |>
  wt_tidy_species(remove = c("mammal","amphibian","abiotic","insect","unknown"), zerofill = F) |>
  mutate(year = lubridate::year(recording_date_time)) |>
  select(location, year, species_code) |>
  distinct() |>
  group_by(location, year) |>
  summarise(species_count = n_distinct(species_code)) |>
  ungroup()

distinct_spp <- nsma_main |>
  as_tibble() |>
  wt_tidy_species(remove = c("mammal","amphibian","abiotic","insect","unknown"), zerofill = F) |>
  mutate(year = lubridate::year(recording_date_time)) |>
  select(species_code) |>
  distinct() |>
  arrange(species_code)
```

A total of `r nrow(all_recs)` recordings were collected across all three years (see @fig-all-recs). Species richness increased at most locations sampled in 2024 compared to 2023, likely reflecting differences in sampling effort (see @fig-spp-rich-locs). For example, Boundary Creek 1 recorded an increase from 16 species in 2023 to 26 species in 2024, while Stagg River 1 increased from 23 to 25 species. Similarly, Tibbitt Lake 1 and Whatì saw notable increases, with species counts rising from 14 to 19 and 7 to 11, respectively. Locations sampled exclusively in 2024, such as Mosquito Creek 2 and Pauline Lake 3, recorded species counts of 3 and 7, respectively, adding to the overall species inventory. In contrast, smaller changes were observed at sites like Cameron River 1, where species richness increased from 8 to 10.

```{r}
#| warning: false
#| message: false
#| echo: false
#| eval: true
#| include: true
#| fig-align: center
#| fig-cap: Species richness at forest monitoring locations across years
#| label: fig-spp-rich-locs
#| cap-location: margin
#| code-fold: true

spp_rich_location |>
  ggplot(aes(x=as.factor(year), y=species_count, fill=as.factor(year), group=as.factor(year))) +
  geom_boxplot(alpha = 0.7) +
  geom_point(alpha = 0.7) +
  theme_bw() +
  scale_fill_viridis_d() +
  xlab('Year') + ylab('Species richness') + labs(fill = "Year") +
  ggtitle('Species richness at each location surveyed for each year')

```

## Species accumulation

The species accumulation curve revealed a steady increase in species richness with additional sampling sites, reaching a richness of 88 species at the maximum total of locations surveyed (*n* = 22). Standard deviations declined consistently with increasing sample size, reflecting greater precision in richness estimates as sampling effort increased. Richness values exhibited diminishing returns beyond approximately 15 locations, indicating that additional sampling yielded fewer new species for the habitats surveyed. This plateau suggests that sampling effort was sufficient to capture most vocalizing species present in the study area.

```{r}
#| warning: false
#| message: false
#| echo: false
#| eval: true
#| include: true
#| fig-align: center
#| fig-cap: Species accumulation curve
#| label: fig-spp-accum
#| cap-location: margin
#| code-fold: true

# Identify the first detection site for each species
first_detection <- nsma_main %>%
  group_by(species_code) %>%
  arrange(recording_date_time) %>%
  summarise(
    FirstSite = first(location),
    FirstDate = first(recording_date_time),
    .groups = "drop"
  )

# Add a column indicating whether each site was the first detection for any species
nsma_main2 <- nsma_main %>%
  left_join(first_detection, by = "species_code") %>%
  mutate(IsFirstDetection = location == FirstSite)

# Create species-by-site matrix
species_matrix <- nsma_main2 %>%
  group_by(year, location, species_code) %>%
  summarise(individual_count = max(individual_order, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(
    names_from = species_code,
    values_from = individual_count,
    values_fill = 0
  ) %>%
  select(-year, -location) %>%
  as.matrix()

# Accumulation curve using vegan
spec_accum <- specaccum(species_matrix, method = "random")

# Create dataframe for plotting accumulation curve
accum_data <- data.frame(
  Sites = spec_accum$sites,
  Richness = spec_accum$richness,
  SD = spec_accum$sd
) %>%
  mutate(
    Lower = Richness - SD,
    Upper = Richness + SD
  )

# Prepare first detection data for plotting
first_detection_data <- first_detection %>%
  mutate(SiteOrder = match(FirstSite, unique(nsma_main$location))) %>%
  left_join(accum_data, by = c("SiteOrder" = "Sites"))

# Plot the accumulation curve with first detections
ggplot(accum_data, aes(x = Sites, y = Richness)) +
  geom_line(color = "blue", size = 1) +
  geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "lightblue", alpha = 0.4) +
  geom_point(
    data = first_detection_data,
    aes(x = SiteOrder, y = Richness),
    size = 3
  ) +
  geom_text(
    data = first_detection_data,
    aes(x = SiteOrder, y = Richness, label = species_code),
    nudge_y = 2, # Adjust to move text slightly above the points
    size = 3
  ) +
  labs(
    title = "Species Accumulation Curve with First Detection Sites",
    x = "Number of Sites",
    y = "Cumulative Number of Species"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    axis.title = element_text(size = 14)
  )



```

## Species through the season

```{r}
#| warning: false
#| echo: false
#| eval: true
#| message: false
#| include: true
#| label: tbl-bird-guilds
#| tbl-cap: Common bird forest species guilds. For nesting habitat; Ag = Agricultural, Be = Beach, Bo = Bog, CW = Coniferous Woodlands, ES = Early Successional, MW = Mixed Woodlands, OW = Open Woodlands, TSS = Treed/Shrubby Swamp, Ur = Urban. Species from CW, MW, OW, TSS were used for analysis.
#| code-fold: true

guilds <- read_csv("bird_guilds.csv") |>
  select(species_common_name, habitat_nesting) |>
  inner_join(nsma_main |> select(species_common_name) |> distinct(), by = c("species_common_name")) |>
  filter(!is.na(habitat_nesting))

datatable(guilds, 
          options = list(
            searching = TRUE,  
            paging = TRUE,    
            pageLength = 10   
          )) |>
  formatStyle(columns = colnames(guilds), 
              backgroundColor = styleEqual(c("NA"), "lightgray"))  

```

```{r}
#| warning: false
#| message: false
#| echo: false
#| eval: true
#| include: true
#| fig-align: center
#| fig-cap: Species activity
#| label: fig-spp-activity
#| cap-location: margin
#| code-fold: true

nsma_main |>
  wt_tidy_species(remove = c("mammal", "amphibian", "abiotic", "insect", "unknown"), zerofill = F) |>
  dplyr::select(location, recording_date_time, species_common_name, species_code, individual_count) |>
  mutate(julian = lubridate::yday(recording_date_time),
         month = month(recording_date_time),
         year = factor(year(recording_date_time))) |>
  group_by(species_code) |>
  add_tally() |>
  ungroup() |>
  group_by(julian, species_code) |>
  add_tally() |>
  ungroup() |>
  arrange(species_code) |>
  mutate(recording_date_time = as.POSIXct(recording_date_time)) |>
  inner_join(guilds |> select(species_common_name, habitat_nesting)) |>
  mutate(habitat_nesting = case_when(
    habitat_nesting == "CW" ~ "Coniferous Woodland",
    habitat_nesting == "MW" ~ "Mixedwood",
    habitat_nesting == "OW" ~ "Open Woodland",
    habitat_nesting == "TSS" ~ "Tree Shrub / Swamp",
    habitat_nesting == "Bo" ~ "Bog",
    habitat_nesting == "Ma" ~ "Marsh",
    habitat_nesting == "Ur" ~ "Urban",
    habitat_nesting == "ES" ~ "Edge / Shrubs",
    habitat_nesting == "Be" ~ "Be",
    TRUE ~ "Undefined"
  )) |>
  rename("Nesting habitat" = habitat_nesting) |>
  ggplot(aes(x = julian, y = species_common_name, fill = `Nesting habitat`)) + 
  geom_density_ridges(scale = 4, rel_min_height = 0.005, alpha = 0.4) + 
  scale_fill_viridis_d() +
  theme_bw() +
  xlab("Day of Year") + 
  ylab("Species")

```

## Species-at-risk

`r length(sar)` species-at-risk were discovered in this dataset (see @tbl-sar).

```{r}
#| warning: false
#| echo: false
#| eval: true
#| message: false
#| include: true
#| label: tbl-sar
#| tbl-cap: Species-at-risk detections
#| code-fold: true

cansar <- read_csv("./assets/CAN-SAR_database.csv") |>
  select(species, sara_status) |>
  distinct() |>
  mutate(across(species, ~ toupper(.)))

sar <- nsma_main |>
  select(species_scientific_name) |>
  distinct() |>
  left_join(cansar, by = c("species_scientific_name" = "species")) |>
  filter(!is.na(species_scientific_name), !is.na(sara_status)) |>
  slice(-4) |>
  pull(species_scientific_name)

nsma_sar <- nsma_main |>
  filter(species_scientific_name %in% sar) |>
  inner_join(cansar |> filter(!(species == "PODICEPS AURITUS" & sara_status == "Endangered")) |> select(species, sara_status), by = c("species_scientific_name" = "species")) |>
  select(location, latitude, longitude, recording_date_time, species_common_name, sara_status) |>
  mutate(recording_date_time = as.POSIXct(recording_date_time, format = "%Y%m%d %H:%M:%S"))

datatable(nsma_sar, 
          options = list(
            searching = TRUE,  
            paging = TRUE,    
            pageLength = 10   
          ))

```

```{r}

soi <- c(
  "Bank Swallow",
  "Barn Swallow",
  "Common Nighthawk",
  "Evening Grosbeak",
  "Harris's Sparrow",
  "Horned Grebe",
  "Lesser Yellowlegs",
  "Olive-sided Flycatcher",
  "Red-necked phalarope",
  "Rusty Blackbird",
  "Short-billed Dowitcher",
  "Short-eared Owl",
  "Snowy Owl",
  "Yellow Rail"
)

nsma_main |>
  filter(species_common_name %in% soi) |>
  select(location, latitude, longitude, recording_date_time, species_common_name) 
  

```


# Discussion

Indigenous-led community-based monitoring is key to protecting the land and wildlife in the North Slave region, ensuring that local knowledge, values, and priorities guide how we understand and care for the environment. By combining environmental sensors with environmental DNA sampling, this program builds a broad, long-term picture of biodiversity. Ongoing monitoring will help track how climate change and wildfires are affecting the land, providing communities with the information they need to protect both the environment and their cultural connections, and to strengthen resilience for future generations.
